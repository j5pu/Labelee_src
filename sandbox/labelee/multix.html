
<!DOCTYPE html>
<html>
<head>
	<title>labelee multix</title>
	<meta charset="utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />


	<link rel="stylesheet" href="{{ STATIC_URL }}labelee/dist/leaflet.css" />
	<link rel="stylesheet" href="{{ STATIC_URL }}labelee/css/font-awesome.min.css">
	<link rel="stylesheet" href="{{ STATIC_URL }}labelee/css/leaflet.awesome-markers.css">
	<link rel="stylesheet" href="{{ STATIC_URL }}labelee/css/leaflet.rrose.css">
	<link rel="stylesheet" href="{{ STATIC_URL }}labelee/css/leaflet-search.css">
	<link rel="stylesheet" href="{{ STATIC_URL }}labelee/css/search-mobile.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}labelee/css/multix.css">


    <script src="{{ STATIC_URL }}labelee/js/scale.fix.js"></script>
		
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<!--script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script-->
	<script src="{{ STATIC_URL }}labelee/dist/leaflet.js"></script>
	<script src="{{ STATIC_URL }}labelee/js/bouncemarker.js"></script>
	<script src="{{ STATIC_URL }}labelee/js/leaflet.awesome-markers.js"></script>
	<script src="{{ STATIC_URL }}labelee/js/L.GeometryUtil.js"></script>
	<script src="{{ STATIC_URL }}labelee/js/L.RotatedMarker.js"></script>
    <script src="{{ STATIC_URL }}labelee/js/L.Symbol.js"></script>
    <script src="{{ STATIC_URL }}labelee/js/L.PolylineDecorator.js"></script>
    <script src="{{ STATIC_URL }}labelee/js/rrose-src.js"></script>
    <script src="{{ STATIC_URL }}labelee/js/leaflet-search.js"></script>
    <script src="{{ STATIC_URL }}labelee/js/jquery.mmenu.js"></script>
    <script src="{{ STATIC_URL }}labelee/js/main.js"></script>

</head>


<body>
    <div id="page">
        <div id="header">
            <a href="#menu-right"></a>
            <span id="fake"></span>
            labelee
        </div>
        <div id="content">
            <div id="map"></div>
        </div>
        <nav id="menu-right">
            <div class="search">
                <input type="text" name="search" placeholder="Buscar..." autocomplete="off" />
            </div>
            <ul>
                <li class="Label">Mapa actual: Matadero</li>

                <li>
                    <span>Sitios <i></i></span>
                    <ul>
                        <li class="Label">A</li>
                        <li><a href="#">Alexa</a></li>
                        <li><a href="#">Alexander</a></li>

                        <li class="Label">F</li>
                        <li><a href="#">Fred</a></li>

                        <li class="Label">J</li>
                        <li><a href="#">James</a></li>
                        <li><a href="#">Jefferson</a></li>
                        <li><a href="#">Jordan</a></li>

                        <li class="Label">K</li>
                        <li><a href="#">Kim</a></li>

                        <li class="Label">M</li>
                        <li><a href="#">Meagan</a></li>
                        <li><a href="#">Melissa</a></li>

                        <li class="Label">N</li>
                        <li><a href="#">Nicole</a></li>

                        <li class="Label">S</li>
                        <li><a href="#">Samantha</a></li>
                        <li><a href="#">Scott</a></li>
                    </ul>
                </li>

                <li>
                    <span>Categorías <i></i></span>
                    <ul>
                        <li class="Label">A</li>
                        <li><a href="#">Adam</a></li>

                        <li class="Label">B</li>
                        <li><a href="#">Ben</a></li>
                        <li><a href="#">Bruce</a></li>

                        <li class="Label">E</li>
                        <li><a href="#">Eddie</a></li>

                        <li class="Label">J</li>
                        <li><a href="#">Jack</a></li>
                        <li><a href="#">John</a></li>

                        <li class="Label">M</li>
                        <li><a href="#">Martina</a></li>
                        <li><a href="#">Matthew</a></li>

                        <li class="Label">O</li>
                        <li><a href="#">Olivia</a></li>
                        <li><a href="#">Owen</a></li>
                    </ul>
                </li>


                <li>
                    <span><a href="#">Compartir</a><i></i></span>
                    <ul>
                        <li><a href="#">Facebook</a></li>
                        <li><a href="#">Twitter</a></li>
                        <li><a href="#">G+</a></li>
                        <li><a href="#">Instagram</a></li>
                        <li><a href="#">Pinterest</a></li>

                    </ul>
                </li>

                <li class="Label">&#160;&#160;&#160;</li>

                <li>

                    <span><a href="#">Otros mapas</a><i></i></span>
                    <ul>
                        <li>
                            <span><a href="#">La Vaguada</a></span>
                            <ul>
                                <li>
                                    <span>Categorías <i></i></span>
                                    <ul>
                                        <li class="Label">A</li>
                                        <li><a href="#">Adam</a></li>

                                        <li class="Label">B</li>
                                        <li><a href="#">Ben</a></li>
                                        <li><a href="#">Bruce</a></li>

                                        <li class="Label">E</li>
                                        <li><a href="#">Eddie</a></li>

                                        <li class="Label">J</li>
                                        <li><a href="#">Jack</a></li>
                                        <li><a href="#">John</a></li>

                                        <li class="Label">M</li>
                                        <li><a href="#">Martina</a></li>
                                        <li><a href="#">Matthew</a></li>

                                        <li class="Label">O</li>
                                        <li><a href="#">Olivia</a></li>
                                        <li><a href="#">Owen</a></li>
                                    </ul>
                                </li>

                                <li>
                                    <span>Sitios <i></i></span>
                                    <ul>
                                        <li class="Label">D</li>
                                        <li><a href="#">David</a></li>
                                        <li><a href="#">Dennis</a></li>

                                        <li class="Label">E</li>
                                        <li><a href="#">Eliza</a></li>

                                        <li class="Label">L</li>
                                        <li><a href="#">Larry</a></li>
                                        <li><a href="#">Lisa</a></li>

                                        <li class="Label">M</li>
                                        <li><a href="#">Michael</a></li>

                                        <li class="Label">R</li>
                                        <li><a href="#">Rachelle</a></li>
                                        <li><a href="#">Rick</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li><a href="#">Parquing Pepe</a></li>
                        <li><a href="#">Metrovacesa</a></li>
                    </ul>
                </li>
                <li>
                    <span><a href="#">Ayuda</a></span>
                    <ul>
                        <li></li>
                    </ul>
                </li>
                <li>
                    <span><a href="#">Info</a></span>
                    <ul>
                        <li></li>
                    </ul>
                </li>




                <li class="no-results"><span>Lo sentimos, no se ha encontrado ningún resultado.</span></li>
            </ul>
        </nav>
    </div>
    <!--script src="{{ STATIC_URL }}labelee/js/map.js"></script-->

    <script>
    ;


    //Obtener variables de la URL
    var variableArray = window.location.search.substring(1).split('-'), //quita el '&' y divide params separados por '-'
        building=variableArray[0],
        floor=variableArray[1],
        point=parseInt(variableArray[2]);


    var STATIC_URL = "{{ STATIC_URL }}/labelee/";

    var map_img = new Image(),
    //mapJson = "parquing_grid.json",
    //rutaJson= "parquing_route.json";


            mapJson = STATIC_URL + "plantaB_grid.json",
            rutaJson= STATIC_URL + "plantaB_route.json";

/*
// Crear mapas base
    var base = {
            "Planta2": L.imageOverlay('{{ STATIC_URL }}labelee/34.jpg', bounds),
            "Planta1": L.imageOverlay('{{ STATIC_URL }}labelee/28.jpg', bounds),
            "Planta0": L.imageOverlay('{{ STATIC_URL }}labelee/29.jpg', bounds),
            "Parquing":L.imageOverlay('{{ STATIC_URL }}labelee/27.jpg', bounds),
        };


// Crear map overlays
    var overlays = {

        'POIs_1': L.layerGroup([

        ]),

        'POIs_2': L.layerGroup([
        ]),


    };
*/

		drawMap(mapJson,rutaJson);

	function drawMap (mapJson, rutaJson)  {

		$.getJSON(mapJson,function(data){
		map_img.src = STATIC_URL + data.map;

			map_img.onload = function(){

			var	mapH = $(document).height(),
				mapW = (map_img.width/map_img.height)*mapH,


				rows= data.num_rows,
				scaleX = mapW/data.num_cols,
				scaleY = mapH/rows,
				offsetX = scaleX/2,
				offsetY = scaleY/2,


				bounds = new L.LatLngBounds(new L.LatLng(0, 0), new L.LatLng(mapH, mapW));

		var pois_1 = new L.LayerGroup();

		var	greenMarker = L.AwesomeMarkers.icon({
						  icon: 'home',
						  color: 'green'
						}),
            blueMarker = L.AwesomeMarkers.icon({
                          icon: 'star',
                          color: 'blue'
                        }),
			redMarker = L.AwesomeMarkers.icon({
						  icon: 'coffee',
						  color: 'red'
						});

/*				originMarker = L.marker(originPoint, { bounceOnAdd: true,
					//bounceOnAddHeight: 20,
					icon: greenMarker})
				.addTo(map)
				.bindPopup("¡Estás justo aquí!");
				//.openPopup();


			//map.setView(originPoint, 1);

			var destinyPoint = [(rs-data.destiny.row)*sY-sY, data.destiny.col*sX+sX],

				redMarker = L.AwesomeMarkers.icon({
				  icon: 'coffee',
				  color: 'red'
				}),

				destinyMarker= L.marker(destinyPoint, { bounceOnAdd: false,bounceOnAddHeight: 4,  icon: redMarker})
				.addTo(map)
				//.bindPopup("Cineteca")
				.on('click', function () {
				    drawRoute(originPoint, destinyPoint, data);
				    //this.openPopup();
					this.bounce(1000, -10);
  					});
*/



		L.marker([75, 100], {icon:redMarker}).bindPopup('POI_1.2').addTo(pois_1);
		L.marker([150, 300],{icon:redMarker}).bindPopup('Hola').openPopup().addTo(pois_1);
		L.marker([50, 150],{icon:redMarker}).bindPopup('POI_1.4').addTo(pois_1);


	    var planta0 = new L.imageOverlay('{{ STATIC_URL }}labelee/34.jpg', bounds),
		    parquing = new L.imageOverlay('{{ STATIC_URL }}labelee/28.jpg',bounds),
		    planta1 = new L.imageOverlay('{{ STATIC_URL }}labelee/29.jpg',bounds),
		    planta2 = new L.imageOverlay('{{ STATIC_URL }}labelee/27.jpg',bounds);


		var map = L.map('map', {
			center: bounds.getCenter(),
			crs: L.CRS.Simple,
			zoom: 0,
            zoomControl:false,
			maxBounds: bounds,
			layers: [planta2, planta1,planta0,pois_1]
		});

		var baseLayers = {
			"Planta2": planta2,
			"Planta1": planta1,
			"Planta0": planta0,
			"Parquing":parquing
		};

		var overlays = {
			"POIs1": pois_1
		};


	    var originMarker = L.marker([200, 400], { bounceOnAdd:false, icon: greenMarker})
	    .addTo(map);
	    //.bindPopup('¡Hola!')
	    	//.openPopup()
	    	//.addTo(pois_1)
            //    .on('click', function () {
                    //this.openPopup();
                    //this.bounce(1000, -10);
            //    });
        var hover_bubble = new L.Rrose({ offset: new L.Point(0,-25), closeButton: false, autoPan: false })
		      .setContent('Estás justo aquí')
		      .setLatLng(originMarker.getLatLng())
		      .openOn(map);

		L.control.layers(baseLayers, overlays).addTo(map);

		parquing.addTo(map);



//pois de muestra para rellenar el mapa
                var pois = [
                    {"col":600, "row": 50, "description":"ocio1"},
                    {"col":500, "row": 100, "description":"acceso1"},
                    {"col":500, "row": 150, "description":"ocio2"},
                    {"col":400, "row": 150, "description":"comida"},
                    {"col":600, "row": 50, "description":"aseos"},
                    {"col":500, "row": 100, "description":"ocio3"},
                    {"col":400, "row": 150, "description":"acceso2"},
                    {"col":300, "row": 200, "description":"tienda1"},
                    {"col":200, "row": 150, "description":"tienda2"},
                    {"col":100, "row": 200, "description":"aseos"},
                ];


                var markersLayer = new L.LayerGroup();	//esta capa contiene los pois buscados
                map.addLayer(markersLayer);

                function customTip(text)
                {
                    var tip = L.DomUtil.create('a', 'colortip');

                    tip.href = "#"+text;
                    tip.innerHTML = text;

                    var subtip = L.DomUtil.create('em', 'subtip', tip);
                    subtip.style.display = 'inline-block';
                    subtip.style.float = 'right';
                    subtip.style.width = '18px';
                    subtip.style.height = '18px';
                    //subtip.style.backgroundColor = text;
                    subtip.style.backgroundColor = 'red';
                    return tip;
                }



                var mobileOpts = {
                //url: jsonpurl,
                //jsonpParam: jsonpName,
                //filterJSON: filterJSONCall,
                text: 'Destino...',
                autoType: false,
                tipAutoSubmit: true,
                autoCollapse: true,
                autoCollapseTime: 6000,
                animateLocation: true,
                markerLocation: true,
                textErr: 'No hay ningún sitio',
                layer: markersLayer,
                callTip: customTip,
                delayType: 800	//with mobile device typing is more slow
            };

                //map.addControl( new L.Control.Search({layer: markersLayer}) );  //inizializa el control 'search' lupa

                ////////////rellena el mapa con marcadores de los pois de muestra
                for(i in pois) {
                    var description = pois[i].description,	//valor buscado
                            loc = [pois[i].col,	pois[i].row],	//posición encontrada
                            marker = new L.Marker(new L.latLng(loc), {title: description, icon: blueMarker} );//propiedad buscada
                    marker.bindPopup('descripción: '+ description );
                    markersLayer.addLayer(marker);
                }



		map.addControl( new L.Control.Search(mobileOpts) );
        map.addControl(new L.Control.Zoom());
		}//image.onload

 		}); //getJSon
	} //drawMap

	</script>
</body>
</html>
