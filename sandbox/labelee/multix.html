
<!DOCTYPE html>
<html>
<head>
	<title>labelee multix</title>
	<meta charset="utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />


	<link rel="stylesheet" href="{{ STATIC_URL }}labelee/dist/leaflet.css" />
	<link rel="stylesheet" href="{{ STATIC_URL }}labelee/css/font-awesome.min.css">
	<link rel="stylesheet" href="{{ STATIC_URL }}labelee/css/leaflet.awesome-markers.css">
	<link rel="stylesheet" href="{{ STATIC_URL }}labelee/css/leaflet.rrose.css">
	<link rel="stylesheet" href="{{ STATIC_URL }}labelee/css/leaflet-search.css">
	<link rel="stylesheet" href="{{ STATIC_URL }}labelee/css/search-mobile.css">


    <script src="{{ STATIC_URL }}labelee/js/scale.fix.js"></script>
		
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<!--script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script-->
	<script src="{{ STATIC_URL }}labelee/dist/leaflet.js"></script>
	<script src="{{ STATIC_URL }}labelee/js/bouncemarker.js"></script>
	<script src="{{ STATIC_URL }}labelee/js/leaflet.awesome-markers.js"></script>
	<script src="{{ STATIC_URL }}labelee/js/L.GeometryUtil.js"></script>
	<script src="{{ STATIC_URL }}labelee/js/L.RotatedMarker.js"></script>
    <script src="{{ STATIC_URL }}labelee/js/L.Symbol.js"></script>
    <script src="{{ STATIC_URL }}labelee/js/L.PolylineDecorator.js"></script>
    <script src="{{ STATIC_URL }}labelee/js/rrose-src.js"></script>
    <script src="{{ STATIC_URL }}labelee/js/leaflet-search.js"></script>

    <script type="text/javascript" language="javascript" src="{{ STATIC_URL }}tlouder/index2_files/jquery.mmenu.js"></script>
    <link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}tlouder/index2_files/examples.css" />

    <link type="text/css" media="all" rel="stylesheet" href="{{ STATIC_URL }}tlouder/index2_files/mmenu.css" />
	<!--[if lte IE 8]><link rel="stylesheet" href="../dist/leaflet.ie.css" /><![endif]-->
	<style type="text/css">
	body {
    padding: 0;
    margin: 0;
    background: #f6f6f6;
    }

    body:before {
        content: "";
        position: fixed;
        top: -10px;
        left: -5px;
        width: 110%;
        height: 10px;

        -webkit-box-shadow: 0 0 10px rgba(0,0,0,.8);
        box-shadow: 0 0 10px rgba(0,0,0,.8);

        z-index: 100;
	}
	html, body, #map {
	    height: 100%;
	}

    html{
        //margin-top:1em;
    }

    #map{
        height: 100%;
        border-left: 3px solid #cfcfcf;
        -webkit-box-shadow: inset 3px 3px 5px rgba(0,0,0,0.4);
        box-shadow: inset 3px 3px 5px rgba(0,0,0,0.4);

    }

   .leaflet-control-search .search-button {
 //       background-position: 0 -30px;
          opacity: .5;
    }

    .leaflet-control-layers-toggle {
        width: 32px !important;
        height: 32px !important;
        opacity: .85;
        border: 2px #cfcfcf solid;
        top: -3px;
        border-radius: 4px;

    }
    .leaflet-control-layers {
        box-shadow: 0 1px 7px rgba(0,0,0,0.4);
        -webkit-box-shadow: 0 1px 7px rgba(0,0,0,0.4);
        background: #f8f8f8;
        top: -2px;
        opacity: .85;

    }

    .leaflet-top {
        top: 3.75% !important;
    }

    .leaflet-control {
        -webkit-box-shadow: 2px 2px 8px rgba(0,0,0,0.3) !important;
        box-shadow: 2px 2px 8px rgba(0,0,0,0.3) !important;
    }
    .mmenu div.search
    {
        background: #eee;
        border-bottom: 2px solid #cfcfcf;
        width: 100%;
        padding: 7% 75px 7% 10px !important;
        position: fixed;
        top: 0;
        z-index: 1;

        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }
    @media all and (min-width: 500px) {
        .mmenu div.search
        {
            width: 500px;
        }
    }
    html.mmenu-right .mmenu div.search
    {
        padding: 5px 10px 5px 75px !important;
    }
    .mmenu div.search input
    {
        background: #;
        border: 1px solid #ddd;
        border-radius: 20px;
        line-height: 30px;
        color: #999;
        display: block;
        width: 100%;
        height: 30px;
        margin: 5px 0;
        padding: 0 0 0 10px;

        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }
    .mmenu div.search ~ ul
    {
        padding-top: 13%;
    }

    .mmenu li.no-results
    {
        border: none;
        font-style: italic;
        color: #666;
        display: none;
    }

    .mmenu li i
    {
        border-radius: 4px;
        background: #cfcfcf;
    //    box-shadow: 0 0 2px rgba( 0, 0, 0, 0.2 );
        font-size: 11px;
        font-weight: bold;
        font-style: normal;
        color: #fff;
        text-indent: 0;
        text-align: center;
        text-shadow: none;
        line-height: 22px;
        display: block;
        width: 20px;
        height: 20px;
        position: absolute;
        right: 120px;
        top: 10px;
    }

    html.mmenu-opened .mmenu-page
    {
        //box-shadow: 0 0 15px rgba( 0, 0, 0, 0.2 );
    }
    .mmenu
    {
        background: #f6f6f6;
    }
    .mmenu *
    {
        text-shadow: none;
    }
    .mmenu li
    {
        border-top-color: #fff;
        border-bottom-color: #ddd;
        position: relative;
    }
    .mmenu li > a,
    .mmenu li > span,
    .mmenu li > a:hover
    {
    //color: #666;
        }
    .mmenu li.mmenu-selected > a,
    .mmenu li.mmenu-selected > span
    {
        background: #fff;
    }
    .mmenu a.mmenu-subopen
    {
        border-left: 1px solid #ddd;
    }
    .mmenu a.mmenu-subclose
    {
        background: #eee;
    }
    .mmenu li.mmenu-label
    {
        background: #cfcfcf;
        color: #999;
        border-color: #cfcfcf;
    }
    .mmenu a.mmenu-subopen:after,
    .mmenu a.mmenu-subclose:before
    {
        border-color: rgba( 0, 0, 0, 0.2 );
    }
    </style>
    <script type="text/javascript">
//Pantalla completaa
//new line

function hideAddressBar()
{
    var android_version = parseFloat(device.version);
    alert(android_version);
    if (!(android_version >= 2.3)) return;

    if(!window.location.hash)
    {
        if(document.height < window.outerHeight)
        {
            document.body.style.height = (window.outerHeight + 50) + 'px';
        }

        setTimeout( function(){ window.scrollTo(0, 1); }, 50 );
    }
}

window.addEventListener("load", function(){ if(!window.pageYOffset){ hideAddressBar(); } } );
window.addEventListener("orientationchange", hideAddressBar );



        /*			//	The menu on the left
         $(function() {

         var $menu = $('nav#menu-left');

         $menu.mmenu();

         //	Search left menu (single level)
         var $input = $menu.find( 'div.search input' );
         var $items = $menu.find( 'li' ).not( '.no-results' );
         var $noresults = $menu.find( 'li.no-results' );

         $input.bind(
         'keyup.search',
         function()
         {
         var search = $(this).val().toLowerCase();
         $items.show().each(
         function()
         {
         if ( $(this).text().toLowerCase().indexOf( search ) == -1 )
         {
         $(this).hide();
         }
         }
         );
         $noresults[ $items.filter( ':visible' ).length ? 'hide' : 'show' ]();
         }
         );
         });
         */

        //	The menu on the right
        $(function() {

            var $menu = $('nav#menu-right');

            $menu.mmenu({
                position: 'left',
                slideDuration    : 300
            });

            //	Add counters
            $menu.find( 'i' ).bind(
                    'count.search',
                    function()
                    {
                        var $t = $(this);
                        var $li = $t.parents( 'li' );
                        var length = $( $t.parent().prev().attr( 'href' ) ).children().not( '.mmenu-label' ).not( '.hidden' ).length - 1;

                        $li.show();
                        $t.text( length );
                        if ( length == 0 )
                        {
                            $li.hide();
                        }
                    }
            ).trigger( 'count.search' );

            //	Search right menu (multiple levels)
            var $input = $menu.find( 'div.search input' );
            var $items = $menu.find( '.mmenu-submenu li' ).not( ':first-child' ).not( '.mmenu-label' ).not( '.no-results' );
            var $labels = $menu.find( 'li.mmenu-label' );
            var $noresults = $menu.find( 'li.no-results' );
            var $counters = $menu.find( 'i' );

            $input.bind(
                    'keyup.search',
                    function()
                    {
                        var search = $(this).val().toLowerCase();
                        $items.each(
                                function()
                                {
                                    var $t = $(this).show().removeClass( 'hidden' );
                                    if ( $t.text().toLowerCase().indexOf( search ) == -1 )
                                    {
                                        $t.hide().addClass( 'hidden' );
                                    }
                                }
                        );
                        $labels.hide();
                        $items.each(
                                function()
                                {
                                    $(this).not( '.hidden' ).prevAll( '.mmenu-label' ).first().show();
                                }
                        );

                        $noresults[ $items.not( '.hidden' ).length ? 'hide' : 'show' ]();
                        $counters.trigger( 'count.search' );
                    }
            );

            //	Click a menu-item
            var $confirm = $('#confirmation');
            $('#menu-right a').not( '.mmenu-subopen' ).not( '.mmenu-subclose' ).bind(
                    'click.example',
                    function( e )
                    {
                        e.preventDefault();
                        $confirm.show().text( 'You clicked "' + $(this).text() + '"' );
                        $('#menu-right').trigger( 'close' );
                    }
            );
        });
    </script>
</head>
<body>
    <div id="page">
        <div id="header">
            <a href="#menu-right"></a>
            <span id="fake"></span>
            labelee
        </div>
        <div id="content">
            <div id="map"></div>
        </div>
        <nav id="menu-right">
            <div class="search">
                <input type="text" name="search" placeholder="Buscar..." autocomplete="off" />
            </div>
            <ul>
                <li class="Label">Mapa actual: Matadero</li>

                <li>
                    <span>Sitios <i></i></span>
                    <ul>
                        <li class="Label">A</li>
                        <li><a href="#">Alexa</a></li>
                        <li><a href="#">Alexander</a></li>

                        <li class="Label">F</li>
                        <li><a href="#">Fred</a></li>

                        <li class="Label">J</li>
                        <li><a href="#">James</a></li>
                        <li><a href="#">Jefferson</a></li>
                        <li><a href="#">Jordan</a></li>

                        <li class="Label">K</li>
                        <li><a href="#">Kim</a></li>

                        <li class="Label">M</li>
                        <li><a href="#">Meagan</a></li>
                        <li><a href="#">Melissa</a></li>

                        <li class="Label">N</li>
                        <li><a href="#">Nicole</a></li>

                        <li class="Label">S</li>
                        <li><a href="#">Samantha</a></li>
                        <li><a href="#">Scott</a></li>
                    </ul>
                </li>

                <li>
                    <span>Categorías <i></i></span>
                    <ul>
                        <li class="Label">A</li>
                        <li><a href="#">Adam</a></li>

                        <li class="Label">B</li>
                        <li><a href="#">Ben</a></li>
                        <li><a href="#">Bruce</a></li>

                        <li class="Label">E</li>
                        <li><a href="#">Eddie</a></li>

                        <li class="Label">J</li>
                        <li><a href="#">Jack</a></li>
                        <li><a href="#">John</a></li>

                        <li class="Label">M</li>
                        <li><a href="#">Martina</a></li>
                        <li><a href="#">Matthew</a></li>

                        <li class="Label">O</li>
                        <li><a href="#">Olivia</a></li>
                        <li><a href="#">Owen</a></li>
                    </ul>
                </li>


                <li>
                    <span><a href="#">Compartir</a><i></i></span>
                    <ul>
                        <li><a href="#">Facebook</a></li>
                        <li><a href="#">Twitter</a></li>
                        <li><a href="#">G+</a></li>
                        <li><a href="#">Instagram</a></li>
                        <li><a href="#">Pinterest</a></li>

                    </ul>
                </li>

                <li class="Label">&#160;&#160;&#160;</li>

                <li>

                    <span><a href="#">Otros mapas</a><i></i></span>
                    <ul>
                        <li>
                            <span><a href="#">La Vaguada</a></span>
                            <ul>
                                <li>
                                    <span>Categorías <i></i></span>
                                    <ul>
                                        <li class="Label">A</li>
                                        <li><a href="#">Adam</a></li>

                                        <li class="Label">B</li>
                                        <li><a href="#">Ben</a></li>
                                        <li><a href="#">Bruce</a></li>

                                        <li class="Label">E</li>
                                        <li><a href="#">Eddie</a></li>

                                        <li class="Label">J</li>
                                        <li><a href="#">Jack</a></li>
                                        <li><a href="#">John</a></li>

                                        <li class="Label">M</li>
                                        <li><a href="#">Martina</a></li>
                                        <li><a href="#">Matthew</a></li>

                                        <li class="Label">O</li>
                                        <li><a href="#">Olivia</a></li>
                                        <li><a href="#">Owen</a></li>
                                    </ul>
                                </li>

                                <li>
                                    <span>Sitios <i></i></span>
                                    <ul>
                                        <li class="Label">D</li>
                                        <li><a href="#">David</a></li>
                                        <li><a href="#">Dennis</a></li>

                                        <li class="Label">E</li>
                                        <li><a href="#">Eliza</a></li>

                                        <li class="Label">L</li>
                                        <li><a href="#">Larry</a></li>
                                        <li><a href="#">Lisa</a></li>

                                        <li class="Label">M</li>
                                        <li><a href="#">Michael</a></li>

                                        <li class="Label">R</li>
                                        <li><a href="#">Rachelle</a></li>
                                        <li><a href="#">Rick</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li><a href="#">Parquing Pepe</a></li>
                        <li><a href="#">Metrovacesa</a></li>
                    </ul>
                </li>
                <li>
                    <span><a href="#">Ayuda</a></span>
                    <ul>
                        <li></li>
                    </ul>
                </li>
                <li>
                    <span><a href="#">Info</a></span>
                    <ul>
                        <li></li>
                    </ul>
                </li>




                <li class="no-results"><span>Lo sentimos, no se ha encontrado ningún resultado.</span></li>
            </ul>
        </nav>
    </div>
	<script>
    ;


    //Obtener variables de la URL
    var variableArray = window.location.search.substring(1).split('-'), //quita el '&' y divide params separados por '-'
        building=variableArray[0],
        floor=variableArray[1],
        point=parseInt(variableArray[2]);


    var STATIC_URL = "{{ STATIC_URL }}/labelee/";

    var map_img = new Image(),
    //mapJson = "parquing_grid.json",
    //rutaJson= "parquing_route.json";


            mapJson = STATIC_URL + "plantaB_grid.json",
            rutaJson= STATIC_URL + "plantaB_route.json";

    /*
// Crear mapas base
    var base = {
            "Planta2": L.imageOverlay('{{ STATIC_URL }}labelee/34.jpg', bounds),
            "Planta1": L.imageOverlay('{{ STATIC_URL }}labelee/28.jpg', bounds),
            "Planta0": L.imageOverlay('{{ STATIC_URL }}labelee/29.jpg', bounds),
            "Parquing":L.imageOverlay('{{ STATIC_URL }}labelee/27.jpg', bounds),
        };


// Crear map overlays
    var overlays = {

        'POIs_1': L.layerGroup([
            L.cartoDB('http://thematicmapping.cartodb.com/api/v2/sql?q=SELECT * FROM nz_tour', {
                pointToLayer: function(feature, latlng) {
                    return L.marker(latlng, {
                        icon: L.icon({
                            iconSize: [27, 27],
                            iconAnchor: [13, 27],
                            popupAnchor:  [1, -24],
                            iconUrl: 'icons/' + feature.properties.icon + '.png'
                        })
                    })
                },
                onEachFeature: function(feature, layer) {
                    layer.bindPopup('<strong>' + feature.properties.name + '</strong><br>' + (feature.properties.description ? feature.properties.description : ''));
                }
            }),
            L.geoJson(roads, {
                style: {
                    color: '#333',
                    weight: 1.5,
                    opacity: 1
                }
            })
        ])

    };

*/


		drawMap(mapJson,rutaJson);

	function drawMap (mapJson, rutaJson)  {

		$.getJSON(mapJson,function(data){ 
		map_img.src = STATIC_URL + data.map;

			map_img.onload = function(){

			var	mapH = $(document).height(),
				mapW = (map_img.width/map_img.height)*mapH,

				
				rows= data.num_rows,
				scaleX = mapW/data.num_cols,
				scaleY = mapH/rows,
				offsetX = scaleX/2,
				offsetY = scaleY/2,


				bounds = new L.LatLngBounds(new L.LatLng(0, 0), new L.LatLng(mapH, mapW));

		var pois_1 = new L.LayerGroup();

		var	greenMarker = L.AwesomeMarkers.icon({
						  icon: 'home', 
						  color: 'green'
						}),
            blueMarker = L.AwesomeMarkers.icon({
                          icon: 'star',
                          color: 'blue'
                        }),
			redMarker = L.AwesomeMarkers.icon({
						  icon: 'coffee', 
						  color: 'red'
						});

/*				originMarker = L.marker(originPoint, { bounceOnAdd: true, 
					//bounceOnAddHeight: 20,
					icon: greenMarker})
				.addTo(map)
				.bindPopup("¡Estás justo aquí!");
				//.openPopup();

			
			//map.setView(originPoint, 1);

			var destinyPoint = [(rs-data.destiny.row)*sY-sY, data.destiny.col*sX+sX],
			
				redMarker = L.AwesomeMarkers.icon({
				  icon: 'coffee', 
				  color: 'red'
				}),

				destinyMarker= L.marker(destinyPoint, { bounceOnAdd: false,bounceOnAddHeight: 4,  icon: redMarker})
				.addTo(map)
				//.bindPopup("Cineteca")
				.on('click', function () {
				    drawRoute(originPoint, destinyPoint, data);
				    //this.openPopup();
					this.bounce(1000, -10);
  					});
*/



		L.marker([75, 100], {icon:redMarker}).bindPopup('POI_1.2').addTo(pois_1);
		L.marker([150, 300],{icon:redMarker}).bindPopup('Hola').openPopup().addTo(pois_1);
		L.marker([50, 150],{icon:redMarker}).bindPopup('POI_1.4').addTo(pois_1);


	    var planta0 = new L.imageOverlay('{{ STATIC_URL }}labelee/34.jpg', bounds),
		    parquing = new L.imageOverlay('{{ STATIC_URL }}labelee/28.jpg',bounds),
		    planta1 = new L.imageOverlay('{{ STATIC_URL }}labelee/29.jpg',bounds),
		    planta2 = new L.imageOverlay('{{ STATIC_URL }}labelee/27.jpg',bounds);


		var map = L.map('map', {
			center: bounds.getCenter(),
			crs: L.CRS.Simple,
			zoom: 0,
            zoomControl:false,
			maxBounds: bounds,
			layers: [planta2, planta1,planta0,pois_1]
		});

		var baseLayers = {
			"Planta2": planta2,
			"Planta1": planta1,
			"Planta0": planta0,
			"Parquing":parquing
		};

		var overlays = {
			"POIs1": pois_1
		};


	    var originMarker = L.marker([200, 400], { bounceOnAdd:false, icon: greenMarker})
	    .addTo(map);
	    //.bindPopup('¡Hola!')
	    	//.openPopup()
	    	//.addTo(pois_1)
            //    .on('click', function () {
                    //this.openPopup();
                    //this.bounce(1000, -10);
            //    });
        var hover_bubble = new L.Rrose({ offset: new L.Point(0,-25), closeButton: false, autoPan: false })
		      .setContent('Estás justo aquí')
		      .setLatLng(originMarker.getLatLng())
		      .openOn(map);
		
		L.control.layers(baseLayers, overlays).addTo(map);

		parquing.addTo(map);



//pois de muestra para rellenar el mapa
                var pois = [
                    {"col":600, "row": 50, "description":"ocio1"},
                    {"col":500, "row": 100, "description":"acceso1"},
                    {"col":500, "row": 150, "description":"ocio2"},
                    {"col":400, "row": 150, "description":"comida"},
                    {"col":600, "row": 50, "description":"aseos"},
                    {"col":500, "row": 100, "description":"ocio3"},
                    {"col":400, "row": 150, "description":"acceso2"},
                    {"col":300, "row": 200, "description":"tienda1"},
                    {"col":200, "row": 150, "description":"tienda2"},
                    {"col":100, "row": 200, "description":"aseos"},
                ];


                var markersLayer = new L.LayerGroup();	//esta capa contiene los pois buscados
                map.addLayer(markersLayer);

                function customTip(text)
                {
                    var tip = L.DomUtil.create('a', 'colortip');

                    tip.href = "#"+text;
                    tip.innerHTML = text;

                    var subtip = L.DomUtil.create('em', 'subtip', tip);
                    subtip.style.display = 'inline-block';
                    subtip.style.float = 'right';
                    subtip.style.width = '18px';
                    subtip.style.height = '18px';
                    //subtip.style.backgroundColor = text;
                    subtip.style.backgroundColor = 'red';
                    return tip;
                }



                var mobileOpts = {
                //url: jsonpurl,
                //jsonpParam: jsonpName,
                //filterJSON: filterJSONCall,
                text: 'Destino...',
                autoType: false,
                tipAutoSubmit: true,
                autoCollapse: true,
                autoCollapseTime: 6000,
                animateLocation: true,
                markerLocation: true,
                textErr: 'No hay ningún sitio',
                layer: markersLayer,
                callTip: customTip,
                delayType: 800	//with mobile device typing is more slow
            };

                //map.addControl( new L.Control.Search({layer: markersLayer}) );  //inizializa el control 'search' lupa

                ////////////rellena el mapa con marcadores de los pois de muestra
                for(i in pois) {
                    var description = pois[i].description,	//valor buscado
                            loc = [pois[i].col,	pois[i].row],	//posición encontrada
                            marker = new L.Marker(new L.latLng(loc), {title: description, icon: blueMarker} );//propiedad buscada
                    marker.bindPopup('descripción: '+ description );
                    markersLayer.addLayer(marker);
                }



		map.addControl( new L.Control.Search(mobileOpts) );
        map.addControl(new L.Control.Zoom());
		}//image.onload

 		}); //getJSon
	} //drawMap


	</script>
</body>
</html>
