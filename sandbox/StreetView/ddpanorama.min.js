/*
 * ddpanorama - jQuery plugin version 1.24
 * Copyright (c) Tiny Studio (http://tinystudio.dyndns.org/)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 * Date: Sat Jul 28 10:59:36 KST 2012
 */

(function(a){var b={animations:[],timerId:-1,max_speed:43e3,drag_constant:1.6,cursorX:0,cursorY:0,currentTime:(new Date).getTime()};b.timerId=window.setInterval(function(){for(var a=0;a<b.animations.length;++a){b.animations[a].update()}},1e3/30);b.mousedown=function(a,c){b.cursorXOld=b.cursorX=a;b.cursorYOld=b.cursorY=c;b.speedX=0};b.mousemove=function(a,c){b.cursorXOld=b.cursorX;b.cursorYOld=b.cursorY;b.cursorX=a;b.cursorY=c;var d=(new Date).getTime();var e=(d-b.currentTime)/1e3;b.currentTime=d;b.speedX=(b.cursorX-b.cursorXOld)/e;if(b.speedX>b.max_speed)b.speedX=b.max_speed;if(b.speedX<-b.max_speed)b.speedX=-b.max_speed};b.event_prefix="ddpanorama_";a(document).bind("mousemove",function(a){b.mousemove(a.pageX,a.pageY)});a(document).bind("touchmove",function(a){b.mousemove(a.originalEvent.touches[0].pageX,a.originalEvent.touches[0].pageY)});a(document).bind("touchstart",function(a){b.mousedown(a.originalEvent.touches[0].pageX,a.originalEvent.touches[0].pageY)});a(document).bind("mousedown",function(a){b.mousedown(a.pageX,a.pageY)});a.fn.ddpanorama=function(c){return this.each(function(){if(a(this).data("ddpanorama")!=null)return;var d=a(this);var e=document.createElement("canvas");var f={img:d,canvas:e,mousedown:false,draw_scale:1,minSpeed:0};a(this).css("display","none");f.params=c;if(f.params==null)f.params={};f.add=function(){var a=b.animations.indexOf(this);if(a<0){b.animations.push(this)}};f.remove=function(){var a=b.animations.indexOf(this);if(a>=0){b.animations.splice(a,1)}};f.setScrollX=function(b){var c=a(this.img).get()[0].naturalWidth;if(isNaN(c)==false&&c!=0){var d=b/this.draw_scale;if(this.loop){while(d<-c)d+=c;while(d>=c)d-=c}else{if(d>this.bounceBorder)d=this.bounceBorder;if(d<this.widthScaled-c-this.bounceBorder)d=this.widthScaled-c-this.bounceBorder}b=d*this.draw_scale;a(this.canvas).prop("scrollX",b)}return b};f.scrollTo=function(b){var c=a(this.canvas).prop("mousedownScrollX");if(c==null)return;var e=a(d).get()[0].naturalWidth;this.setScrollX(c+b-a(this.canvas).prop("mousedownPageX"))};f.update=function(){var c=(new Date).getTime();var d=a(this.canvas).prop("updateTime");if(d==null)d=c;a(this.canvas).prop("updateTime",c);var e=(c-d)/1e3;var f=a(this.canvas).prop("scrollX");var g=a(this.canvas).prop("speedX");var h=this.canvas.getContext("2d");var i=a(this.img).get()[0].naturalWidth;f+=e*g;f=this.setScrollX(f);var j=0;if(this.loop==false){var k=f/this.draw_scale;if(this.bounceActive){if(k>0){if(g>0){g=0}j=-k*this.bounceSpringConst}else if(k<this.widthScaled-i){if(g<0){g=0}j=(this.widthScaled-i-k)*this.bounceSpringConst}}}if(this.loop==false&&this.bounce){var l=e*2.5;if(k>=0){var m=k;var n=m/this.bounceBorder;if(m>=0){if(g<0){g*=n}}g+=j*l}else if(this.widthScaled-i-k>=0){var m=this.widthScaled-i-k;var n=m/this.bounceBorder;if(m>=0){if(g>0){g*=n}}g+=j*l}}g+=b.drag_constant*(this.minSpeed-g)*e;a(this.canvas).prop("speedX",g);this.redraw();if(Math.abs(g)<1&&this.minSpeed==0&&Math.abs(j)<3){this.stop();this.remove()}};f.stop=function(){a(this.canvas).prop("speedX",0)};f.redraw=function(){var c=a(this.img).get()[0].naturalWidth;var d=this.canvas.getContext("2d");var e=a(this.canvas).prop("scrollX");var f=a(this.canvas).prop("speedX");e/=this.draw_scale;var g=false;if(isNaN(c)==false&&c!=0){a(this.canvas).prop("forceX",0);var h=this.img.get()[0];d.setTransform(this.draw_scale,0,0,this.draw_scale,0,0);if(this.loop){d.drawImage(h,e,0);d.drawImage(h,e+c,0);d.drawImage(h,e-c,0)}else{d.drawImage(h,e,0);d.fillStyle=this.bounceEdgeColor;d.fillRect(0,0,e,this.canvas.height/this.draw_scale);d.fillRect(c+e,0,this.bounceBorder,this.canvas.height/this.draw_scale)}g=true}else{d.setTransform(1,0,0,1,0,0);d.fillStyle="#000000";d.fillRect(0,0,this.canvas.width,this.canvas.height)}a(this.img).trigger(jQuery.Event(b.event_prefix+"redraw",{canvas:this.canvas,speed:a(this.canvas).prop("speedX")/b.max_speed,loaded:g}))};f.onmousedown=function(b){var c=this;var d=this.canvas;this.mousedown=true;a(d).prop("speedX",0);var e=(new Date).getTime();this.remove();this.stop();a(d).prop("mousedownPageX",b);a(d).prop("mousedownScrollX",a(d).prop("scrollX"));a(d).prop("updateTime",e);this.old_onselectstart=document.onselectstart;document.onselectstart=function(){return false}};f.resize=function(){var b=this.img;var c=this.canvas;var d=b.get()[0].naturalWidth;var e=b.get()[0].naturalHeight;var f=d;var g=b.get()[0].naturalHeight;if(this.params.hasOwnProperty("height")){g=this.params.height}if(this.params.hasOwnProperty("ratio")){if(this.params.hasOwnProperty("width")){f=this.params.width;g=f*this.params.ratio}else{f=g/this.params.ratio}}else if(this.params.hasOwnProperty("width")){f=this.params.width}if(e!=0)this.draw_scale=g/e;else this.draw_scale=1;if(this.params.hasOwnProperty("startPos")){this.setScrollX(d*-this.params.startPos*this.draw_scale+f)}a(c).attr("width",f);a(c).attr("height",g);this.widthScaled=this.canvas.width/this.draw_scale;this.bounceActive=this.bounce;if(this.bounce){var h=.8;if(this.params.hasOwnProperty("bounceEdge")){h=this.params.bounceEdge}this.bounceBorder=this.canvas.width*h/this.draw_scale;if(this.bounceBorder<1){this.bounceActive=false}}else{this.bounceBorder=0}};a(this).data("ddpanorama",f);a(e).data("ddpanorama",f);a(e).prop("scrollX",0);a(e).prop("speedX",0);var g=function(c){var d=a(this).data("ddpanorama");if(d.mousedown==false)return;d.mousedown=false;d.add();var f=(new Date).getTime();var g=a(this).prop("updateTime");a(this).prop("updateTime",f);a(e).prop("speedX",b.speedX);a(e).prop("mousedownScrollX",null);document.onselectstart=this.old_onselectstart};var h=0;var i=true;if(c.hasOwnProperty("minSpeed"))h=c.minSpeed;if(c.hasOwnProperty("interactive"))i=c.interactive;if(i){a(e).mousedown(function(b){var c=a(this).data("ddpanorama");c.onmousedown(b.pageX)});a(e).css("cursor","pointer");a(e).css("-webkit-touch-callout","none");a(e).css("-webkit-user-select","none");a(e).css("-khtml-user-selec","none");a(e).css("-moz-user-select","none");a(e).css("-ms-user-select","none");a(e).css("user-select","none");a(e).bind("mouseup",g);a(e).bind("mouseupoutside",g);a(e).bind("mousemove",function(b){var c=b.pageX;var d=a(this).data("ddpanorama");if(d.mousedown==false)return;d.scrollTo(c);d.redraw()});a(e).bind("contextmenu",function(a){a.preventDefault();return false});a(e).bind("touchstart",function(b){var c=a(this).data("ddpanorama");c.onmousedown(b.originalEvent.touches[0].pageX)});a(e).bind("touchmove",function(b){b.preventDefault();var c=a(this).data("ddpanorama");if(c.mousedown==false)return false;var d=b.originalEvent.touches[0].pageX;c.scrollTo(d);c.redraw()});a(e).bind("touchend",g)}f.minSpeed=h;if(h!=0){f.add()}f.loop=true;if(c.hasOwnProperty("loop"))f.loop=c.loop;f.bounce=true;if(c.hasOwnProperty("bounce"))f.bounce=c.bounce;f.bounceEdgeColor="#000000";if(c.hasOwnProperty("bounceEdgeColor"))f.bounceEdgeColor=c.bounceEdgeColor;f.bounceSpringConst=15;if(c.hasOwnProperty("bounceSpringConst"))f.bounceSpringConst=c.bounceSpringConst;f.resize();f.redraw();d.after(e);a(this).load(function(){f.resize();f.redraw()})})}})(jQuery)