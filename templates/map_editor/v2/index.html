{% extends "base.html" %}

{% load i18n %}

{% block css %}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/map_editor/styles.css"/>
    <link rel="stylesheet" href="{{ STATIC_URL }}css/map_editor/index/styles.css"/>
{% endblock css %}


{% block js %}
    <script src="{{ STATIC_URL }}vendor/bootstrap/bootstrap.file-input.js"></script>
    <script src="{{ STATIC_URL }}js/map_editor/index/main.js"></script>
{% endblock js %}


{% block content %}

    {% csrf_token %}

    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                {% include "_lang_selector.html" %}
                <a class="brand" href="#">{% trans "Administración de recintos" %}</a>

                <div class="nav-collapse">
                <ul class="nav">
                    <li><a href="#"><i class="icon-white icon-home"></i> Enclosure Manager</a></li>
                    <li><a href="#"><i class="icon-white icon-picture"></i> Enclosure Site</a>
                    </li>
                    <li class="active"><a href="#"><i class="icon-white icon-play-circle"></i>
                        Labelee App</a></li>
                    <li><a href="#"><i class="icon-white icon-book"></i> Anything</a></li>
                </ul>
                <ul class="nav pull-right">
                    <li><p class="navbar-text"><i class="icon-white icon-download"></i> Download:</p></li>
                    <li>
                        <div class="btn-group">
                            <a class="btn btn-small btn-primary" href="#">PDF</a>
                            <a class="btn btn-small btn-primary" href="#">E-MAIL</a>
                        </div>
                    </li>
                    <li>
                        <!-- CAJITA DE LOGOUT -->
                        {% if user.is_authenticated %}
                            <div id="logout" class="box box-1">
                                {% trans "Bienvenido" %}, {{ user.username }} |
                                <a href="{% url 'django.contrib.auth.views.logout' %}">Logout</a>
                            </div>
                        {% endif %}
                    </li>
                </ul>
            </div>
            <!--/.nav-collapse -->


        </div>
    </div>
</div>



    <div>
        <h1>{% trans "Administración de recintos" %}</h1>
        <span class="link-1 add_new" ng-click="show_create_enclosure_form()">
            <i class="icon-plus-sign"></i>
            {% trans "Agregar nuevo recinto" %}
        </span>
    </div>


    {% if user.logo %}
        <img src="{{ MEDIA_URL }}{{ user.logo }}">
    {% endif %}


    <table id="enclosures"
           class="table table-hover"
           ng-controller="EnclosureListCtrl">
        <thead>
        <tr>
            <th>
                <span>{% trans "Recintos" %}</span>
            </th>
            <th>
                <span>{% trans "Plantas" %}</span>
            </th>
            <th>
                <span>{% trans "Categorías" %}</span>
            </th>
        </tr>
        </thead>

        <tbody>
        <tr
                ng-repeat="enclosure in enclosures | orderBy:'name':reverse"
            ng-controller="EnclosureCtrl">

            <td class="enclosure"
                ng-mouseover="hovered = true" ng-mouseleave="hovered = false">

                <h2>[[enclosure.name]]</h2>

                <h4 ng-show="enclosure.twitter_account">@[[enclosure.twitter_account]]</h4>
                <img class="logo" ng-src="[[enclosure.logo]]">
                <div class="urls">
                    <a ng-show="enclosure.url_enclosure"
                       href="[[enclosure.url_enclosure | url]]">{% trans  "Web del recinto" %}</a>
                    <a ng-show="enclosure.url_dashboard"
                       href="[[enclosure.url_dashboard | url]]">{% trans  "Ver dashboard" %}</a>
                </div>
                <div class="poi_count">{% trans "Número de POIS/QRs:" %} [[enclosure.poi_count]]</div>
                <div class="floor_count">{% trans "Número de plantas:" %} [[enclosure.floors.length]]</div>

                <button class="btn link-2" ng-click="show_edit_form()">
                    {% trans "Editar" %}
                </button>
                <a class="btn link-2" ng-click="calculateRoutes()">
                    <i class="icon-road icon-white"></i> {% trans "Calcular rutas" %}
                </a>
                <a class="btn link-2" id="aristas" href='edit/connections/[[enclosure.id]]'>
                    <i class="icon-pencil icon-white"></i> {% trans "Conexiones entre plantas" %}
                </a>
            </td>

            <!-- PLANTAS -->
            <td class="floors"
                ng-mouseover="hovered = true" ng-mouseleave="hovered = false"
                ng-controller="FloorListCtrl">

                <!-- CADA PLANTA -->
                <table ng-hide="enclosure.floors.length == 0">
                    <thead>
                    <tr>
                        <th>{% trans "Plantas" %}</th>
                        <th>{% trans "Puntos de interés" %}</th>
                    </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="floor in enclosure.floors | orderBy:'floor_number':reverse"
                            ng-controller="FloorCtrl" class="floor">
                            <td>
                                [[floor.name]]
                                <button class="btn link-2" ng-click="show_edit_floor_form()">
                                    {% trans "Editar" %}
                                </button>
                            </td>
                            <td>
                                [[floor.poi_count]]
                                <a href="[[urls.map_editor.edit]]/[[floor.id]]">
                                   <button class="btn link-2">{% trans "Editar" %}</button>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <span class="link-1" ng-click="show_create_floor_form()">
                    <i class="icon-plus-sign"></i>
                    {% trans "Agregar nueva planta" %}
                </span>
            </td>

            <!-- CATEGORÍAS -->
            <td class="categories" ng-controller="CategoryListCtrl">
                <div>
                    <span>{% trans "Genéricas" %}</span>
                    <!-- GENÉRICAS -->
                    <ul>
                        <li ng-repeat="category in enclosure.label_categories | orderBy:'name'"
                            ng-show="!category.enclosure" ng-controller="CategoryCtrl">
                            <span>
                                [[category.name]] ([[category.poi_count]])
                                <button class="btn link-2"
                                        ng-show="user_is_staff"
                                        ng-click="show_edit_category_form()">
                                    {% trans "Editar" %}
                                </button>
                            </span>
                        </li>
                    </ul>
                </div>
                <div>
                    <span>{% trans "Personalizadas" %}</span>
                    <ul>
                        <li class="category" ng-repeat="category in enclosure.label_categories | orderBy:'name'"
                            ng-show="category.enclosure" ng-controller="CategoryCtrl">
                            <span>
                                [[category.name]] ([[category.poi_count]])
                                <button class="btn link-2"
                                        ng-click="show_edit_category_form()">
                                    {% trans "Editar" %}
                                </button>
                            </span>
                        </li>
                    </ul>
                </div>

                <br>

                <span class="link-1" ng-click="show_create_category_form()">
                    <i class="icon-plus-sign" ></i>
                    {% trans "Añadir nueva categoría" %}
                </span>

{#                <div class="forms">#}
{#                    <div ng-include src="'category_forms'"></div>#}
{#                </div>#}
            </td>
        </tr>
        </tbody>
    </table>




    <!--
        DIÁLOGOS
                    -->
    <div id="dialogs">
        <div id="enc_create" ng-controller="EnclosureFormsCtrl">
            <form class="create"
                  action=""
                  method="post"
                  enctype="multipart/form-data"
                  target="upload_target">
                <label class="txt">{% trans "Nuevo nombre:" %}
                    <input type="text"
                           ng-model="enclosure_name"
                           placeholder="{% trans "Nombre para el recinto" %}.."
                           autofocus>
                </label>
                <label class="txt">
                    {% trans "Cuenta de Twitter:" %}
                    <input type="text"
                           ng-model="twitter_account"
                           placeholder="{% trans "Cuenta de twitter" %}..">
                </label>
                <label class="txt">
                    {% trans "Logo del recinto:" %}
                    <input class="btn"
                               type="file"
                               name="logo"
                               title="{% trans "Subir imagen" %}">
                </label>
                <label class="txt">
                    {% trans "URL del recinto:" %}
                    <input type="text"
                           ng-model="url_enclosure"
                           placeholder="{% trans "Introduzca la URL del recinto" %}..">
                </label>
                <label class="txt">
                    {% trans "URL del dashboard:" %}
                    <input type="text"
                           ng-model="url_dashboard"
                           placeholder="{% trans "Introduzca la URL del dashboard" %}..">
                </label>

                <button class="btn" ng-click="create()">{% trans "Añadir recinto" %}</button>
            </form>
        </div>

        <div id="enc_edit" ng-controller="EnclosureFormsCtrl">
            <form class="edit"
                  action=""
                  method="post"
                  enctype="multipart/form-data"
                  target="upload_target">
                <label class="txt">{% trans "Nuevo nombre:" %}
                    <input type="text"
                           ng-model="enclosure_name"
                           placeholder="{% trans "Nuevo nombre para el recinto" %}.."
                           autofocus>
                </label>
                <label class="txt">
                    {% trans "Cuenta de Twitter:" %}
                    <input type="text"
                           ng-model="twitter_account"
                           placeholder="{% trans "Cuenta de twitter" %}..">
                </label>
                <label class="txt">
                    {% trans "Logo del recinto:" %}
                    <input class="btn"
                               type="file"
                               name="logo"
                               title="{% trans "Cambiar imagen" %}">
                </label>
                <label class="txt">
                    {% trans "URL del recinto:" %}
                    <input type="text"
                           ng-model="url_enclosure"
                           placeholder="{% trans "Introduzca la URL del recinto" %}..">
                </label>
                <label class="txt">
                    {% trans "URL del dashboard:" %}
                    <input type="text"
                           ng-model="url_dashboard"
                           placeholder="{% trans "Introduzca la URL del dashboard" %}..">
                </label>

                <button class="btn" ng-click="closeModalDialog()">{% trans "Cancelar" %}</button>
                <button class="btn" ng-click="update()">{% trans "Guardar" %}</button>

                <button class="btn" ng-click="del()">{% trans "Eliminar recinto" %}</button>
            </form>
        </div>


        <div id="floor_create" ng-controller="FloorFormsCtrl">
            <form class="create"
                  action=""
                  method="post"
                  enctype="multipart/form-data"
                  target="upload_target">

                <div class="form_content" ng-hide="sending_img">
                    <div class="box-3">
                        <label class="txt">{% trans "Nombre de planta" %}:
                            <input type="text"
                                   ng-model="floor_name"
                                   placeholder="{% trans "Nombre de planta" %}..">
                        </label>
                        <label class="txt">{% trans "Número" %}:
                            <input type="text"
                                   ng-model="floor_number"
                                   placeholder="{% trans "Número" %}..">
                        </label>
                        <input class="btn floor_img"
                               type="file"
                               name="img"
                               title="{% trans "Elegir imagen" %}">
                    </div>

                    <button class="btn" ng-click="create()">{% trans "Añadir planta" %}</button>
                </div>

                {% include "_waiting_gif.html" %}
            </form>
        </div>

        <div id="floor_edit" ng-controller="FloorFormsCtrl">
            <form class="edit"
                  action=""
                  method="post" enctype="multipart/form-data"
                  target="upload_target">

                <div class="box-2 editing-floor">
                    <label class="txt">{% trans "Nombre" %}:
                        <input type="text"
                               ng-init="floor_name=floor.name"
                               ng-model="floor_name"
                               placeholder="{% trans "Nuevo nombre para la planta" %}.."
                               autofocus>
                    </label>
                    <label class="txt">{% trans "Número" %}:
                        <input type="text"
                               ng-init="floor_number=floor.floor_number"
                               ng-model="floor_number"
                               ng-change="validate()"
                               placeholder="{% trans "Número" %}..">
                    </label>
                    <label class="txt">{% trans "Imagen .svg" %}:</label>
                    <input class="btn"
                           type="file"
                           name="img"
                           title="{% trans "Cambiar imagen" %}">
                    <label class="txt">{% trans "Imagen .png" %}:</label>
                    <input class="btn"
                           type="file"
                           name="imgB"
                           title="{% trans "Cambiar imagen" %}">
                </div>

                <button class="btn" ng-click="closeModalDialog()">{% trans "Cancelar" %}</button>
                <button class="btn" ng-click="update()">{% trans "Guardar" %}</button>
                <button class="btn" ng-click="del()">{% trans "Eliminar planta" %}</button>

                {% include "_waiting_gif.html" %}
            </form>
        </div>


{#        <script type="text/ng-template" id="category_forms">#}
        <div id="category_create" ng-controller="CategoryFormsCtrl">
            <form class="create">
                <span>{% trans "Nueva categoría para el recinto" %} [[enclosure.name]]</span>
                <label class="txt">{% trans "Nombre" %}:
                    <input type="text"
                           ng-model="category_name"
                           placeholder="{% trans "Nombre para la categoría" %}..">
                </label>
                <label class="txt">{% trans "Color" %}:
                    <input type="text"
                           ng-model="category_color"
                           placeholder="{% trans "Color para la categoría" %}..">
                </label>
                <button class="btn" ng-click="create()">{% trans "Añadir categoría" %}</button>
            </form>
        </div>


        <div id="category_edit" ng-controller="CategoryFormsCtrl">
            <form class="edit">
                <label class="txt">{% trans "Nombre" %}:
                    <input type="text"
                           ng-model="category_name"
                           placeholder="{% trans "Nuevo nombre para la categoría" %}..">
                </label>
                <label class="txt">{% trans "Color" %}:
                    <input type="text"
                           ng-model="category_color"
                           placeholder="{% trans "Nuevo color para la categoría" %}..">
                </label>
                <button class="btn" ng-click="closeModalDialog()">{% trans "Cancelar" %}</button>
                <button class="btn" ng-click="update()">{% trans "Guardar" %}</button>
                <button class="btn" ng-click="del()">{% trans "Eliminar" %}</button>
            </form>
        </div>
{#        </script>#}
    </div>


    {% include "_uploading_iframe.html" %}

{% endblock content %}
